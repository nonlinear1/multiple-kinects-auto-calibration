<launch>

    <rosparam command="load" file="$(find calib)/config/default_transform.yaml" />
    <rosparam command="load" file="$(find calib)/config/default_preproc.yaml" />
    <rosparam command="load" file="$(find calib)/config/default_planes.yaml" />
    <rosparam command="load" file="$(find calib)/config/default_match.yaml" />

    <param name="cam_source" value="cam1" />
    <param name="cam_target" value="cam2" />
    <param name="merged_name" value="scene" />

    <node pkg="calib" name="preproc_$(arg cam_source)" type="preprocessing_node" respawn="true" output="screen" args="/$(arg cam_source)/qhd/points $(arg cam_source)" />
    <node pkg="calib" name="preproc_$(arg cam_target)" type="preprocessing_node" respawn="true" output="screen" args="/$(arg cam_target)/qhd/points $(arg cam_target)" />

    <node pkg="calib" name="plane_detection_$(arg cam_source)" type="plane_detection_node" respawn="true" output="screen" args="$(arg cam_source)" />
    <node pkg="calib" name="plane_detection_$(arg cam_target)" type="plane_detection_node" respawn="true" output="screen" args="$(arg cam_target)" />
    
    <node pkg="calib" name="matching_$(arg cam_source)_$(arg cam_target)" type="matching_node" respawn="true" output="screen" args="$(arg cam_source) $(arg cam_target)" />
    <node pkg="calib" name="transform_estimation_$(arg cam_source)_$(arg cam_target)" type="transform_estimation_node" respawn="true" output="screen" args="$(arg cam_source) $(arg cam_target)" />
    
    <node pkg="calib" name="merging_$(arg cam_source)_$(arg cam_target)" type="merging_node" respawn="true" output="screen" args="$(arg cam_source) $(arg cam_target) $(arg merged_name)" />
    <node pkg="calib" name="preproc_$(arg merged_name)" type="preprocessing_node" respawn="true" output="screen" args="/calib/clouds/$(arg merged_name) $(arg merged_name)" />

    <node pkg="calib" name="tf_filter_$(arg cam_source)_$(arg cam_target)" type="tf_node" respawn="true" output="screen" args="cam_center $(arg cam_source) $(arg cam_target)" />
</launch>
